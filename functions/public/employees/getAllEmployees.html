<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/W1qxgjkZ/logo.jpg">
    <title>Admin Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        /* Custom scrollbar styles */
        ::-webkit-scrollbar {
            width: 6px; /* Setting the width of the scrollbar */
            height: 4px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1; /* Setting the background color of the track */
        }

        ::-webkit-scrollbar-thumb {
            background: #888; /* Setting the color of the scrollbar thumb */
            border-radius: 5px; /* Setting the border radius of the scrollbar thumb */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555; /* Setting the color of the scrollbar thumb on hover */
        }

        .status-active {
            color: green !important;
        }

        .status-inactive {
            color: red !important;
        }

        .role-user {
            color: blue !important;
        }

        .role-employee {
            color: orange !important;
        }

        .role-manager {
            color: purple !important;
        }

        .role-admin {
            color: red !important;
        }

        .role-super-admin {
            color: gold !important;
        }

        .role-third-party-agent {
            color: grey !important;
        }

        body {
            background-color: #f8f9fa; /* Setting a light background color */
        }

        .container-fluid {
            padding-top: 30px; /* Adding some padding to the top */
        }

        .table {
            background-color: #fff; /* Setting a white background for the table */
        }

        .table thead th {
            border-bottom: none; /* Removing border-bottom for table header */
        }

        .table tbody tr {
            border-bottom: 1px solid #dee2e6; /* Adding a bottom border for table rows */
        }

        .table-bordered th,
        .table-bordered td {
            border: none; /* Removing borders for table cells */
        }

        .table-bordered {
            border: none; /* Removing border for the table itself */
        }
    </style>
</head>
<body>
<div class="container-fluid mt-5">
    <h1 class="text-center mb-4">Admin Dashboard</h1>
    <div class="row">
        <div class="col-md-12">
            <h3>Employee Table</h3>
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                    <tr>
                        <th>Employee ID</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Phone Number</th>
                        <th>Marital Status</th>
                        <th>Role</th>
                        <th>Account Status</th>
                        <th>Actions</th>
                        <th>Route Access</th>
                    </tr>
                    </thead>
                    <tbody id="employeeTableBody">
                    <!-- Employee details will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS (optional if you require dropdowns, modals, etc.) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/employeeRoutes.js"></script>
<script>
    // Define updateStatus function
    function updateStatus(employeeId, status) {
        fetch(`/api/employee-status/${employeeId}`, {
            method: "PATCH",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ status }),
        })
        .then((response) => {
            if (!response.ok) {
                throw new Error("Failed to update status");
            }
            return response.json();
        })
        .then((data) => {
            // Reload employee data after status update
            fetchEmployees();
            console.log("Status updated successfully:", data);

            // Update the status in the table cell
            const statusCell = document.querySelector(`#status-${employeeId}`);
            statusCell.textContent = status;
            statusCell.className = status === "active" ? "status-active" : "status-inactive";
        })
        .catch((error) => console.error("Error updating status:", error));
    }

    // Define updateRole function
    function updateRole(employeeId, role) {
        fetch(`/api/updateRole/${employeeId}`, {
            method: "PATCH",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ role }),
        })
        .then((response) => {
            if (!response.ok) {
                throw new Error("Failed to update role");
            }
            return response.json();
        })
        .then((data) => {
            // Reload employee data after role update
            fetchEmployees();
            console.log("Role updated successfully:", data);
        })
        .catch((error) => console.error("Error updating role:", error));
    }

    // Define fetchEmployees function
    function fetchEmployees() {
        const employeeTableBody = document.getElementById("employeeTableBody");
        fetch("/api/getall-employees")
        .then((response) => response.json())
        .then((data) => {
            // Clear existing table rows
            employeeTableBody.innerHTML = "";

            // Iterate over employee data and populate table
            data.forEach((employee) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${employee.employeeId}</td>
                    <td>${employee.firstName}</td>
                    <td>${employee.lastName}</td>
                    <td>${employee.employeePhoneNumber}</td>
                    <td id="role-${employee.employeeId}" class="role-${employee.role.toLowerCase()}">${employee.role}</td>
                    <td>${employee.designation}</td>
                    <td id="status-${employee.employeeId}" class="${employee.accountStatus === "active" ? "status-active" : "status-inactive"}">${employee.accountStatus}</td>
                    <td>
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="actionsDropdown-${employee.employeeId}" data-bs-toggle="dropdown" aria-expanded="false">
                                Actions
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="actionsDropdown-${employee.employeeId}">
                                <li><a class="dropdown-item" href="#" onclick="updateStatus('${employee.employeeId}', 'active')">Active</a></li>
                                <li><a class="dropdown-item" href="#" onclick="updateStatus('${employee.employeeId}', 'inactive')">Inactive</a></li>
                            </ul>
                        </div>
                    </td>
                    <td>
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="roleDropdown-${employee.employeeId}" data-bs-toggle="dropdown" aria-expanded="false">
                                Assign Role
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="roleDropdown-${employee.employeeId}">
                                <li><a class="dropdown-item" href="#" onclick="updateRole('${employee.employeeId}', 'User')">User</a></li>
                                <li><a class="dropdown-item" href="#" onclick="updateRole('${employee.employeeId}', 'Employee')">Employee</a></li>
                                <li><a class="dropdown-item" href="#" onclick="updateRole('${employee.employeeId}', 'Manager')">Manager</a></li>
                                <li><a class="dropdown-item" href="#" onclick="updateRole('${employee.employeeId}', 'Admin')">Admin</a></li>
                                <li><a class="dropdown-item" href="#" onclick="updateRole('${employee.employeeId}', 'Super Admin')">Super Admin</a></li>
                                <li><a class="dropdown-item" href="#" onclick="updateRole('${employee.employeeId}', 'Third Party Agent')">Third Party Agent</a></li>
                            </ul>
                        </div>
                    </td>`;
                employeeTableBody.appendChild(row);
            });
        })
        .catch((error) => console.error("Error fetching employees:", error));
    }

    // Initial fetch of employee data
    fetchEmployees();
</script>
</body>
</html>
