<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About Us Page</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <form id="supportForm" action="/send-otp" method="post">
        <h1><span style="color:#083362">Support</span> <span style="color: #ff2f68;">Request</span></h1>

        <label id="nameLabel" for="phone">Phone Number:</label>
        <input type="tel" id="phone" name="phone" maxlength="10" pattern="[0-9]{10}" required
            oninput="this.value = this.value.replace(/[^0-9]/g, '');">
        <span id="phoneError" class="error"></span>
        <a href="#" id="verify-link" onclick="showMsg91Window()">Verify</a>

        <label id="nameLabel" for="name">Name:</label><br>
        <input type="text" id="name" name="name" required disabled>
        <span id="nameError" class="error"></span><br>

        <label for="email">Email:</label><br>
        <input type="email" id="email" name="email" required disabled>
        <span id="emailError" class="error"></span><br>

        <label id="messageLabel" for="message">Enter Your Message:</label><br>
        <textarea id="message" name="message" disabled></textarea>
        <span id="messageError" class="error"></span><br>

        <input type="submit" id="submitButton" value="Submit Support Request !" disabled>
    </form>

    <script src="https://control.msg91.com/app/assets/otp-provider/otp-provider.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript">
        var configuration = {
            widgetId: "34616c746f61383137363438",
            tokenAuth: "381781T3dHu7YQ658dc8e8P1",
            identifier: "phone",
            exposeMethods: "<true | false> (optional)",
            success: (data) => {
                console.log('success response', data);
                document.getElementById('message').disabled = false;
                document.getElementById('verify-link').innerText = 'Verified';
                document.getElementById('verify-link').style.color = '#3dc944';
                enableFormFields();
            },
            failure: (error) => {
                console.log('failure reason', error);
                alert('Verification failed. Please try again.');
            },
            "OTP": "<OTP>"
        };

        function showMsg91Window() {
            validateAndDisplayStatus('phone', 'phoneError');

            var phone = document.getElementById('phone').value.trim();

            if (phone !== "") {
                // Updating the identifier in the configuration with the entered phone number
                configuration.identifier = phone;
                initSendOTP(configuration);
            }
        }

        function enableFormFields() {
            document.getElementById("name").disabled = false;
            document.getElementById("email").disabled = false;
            document.getElementById("message").disabled = false;

            // Disable the phone field to prevent number change
            document.getElementById('phone').disabled = true;

            // Enable the submit button
            document.getElementById("submitButton").disabled = false;
        }

        document.getElementById("supportForm").addEventListener("submit", function (event) {
            event.preventDefault();

            // Validate and display status for the message field
            validateAndDisplayStatus('message', 'messageError');

            // Check if all fields are filled
            if (document.getElementById("name").value.trim() !== "" &&
                document.getElementById("email").value.trim() !== "" &&
                document.getElementById("message").value.trim() !== "") {

                // Alert for demonstration purposes (you can remove this in production)
                alert("Form is now ready for submission");

                // Log form values after successful verification
                var formData = {
                    name: document.getElementById("name").value.trim(),
                    email: document.getElementById("email").value.trim(),
                    phone: document.getElementById("phone").value.trim(),
                    message: document.getElementById("message").value.trim()
                };
                console.log('Form Data after OTP verification:', formData);
                // Clear the form fields
                document.getElementById("supportForm").reset();
            } else {
                alert("Please fill in all fields before submission.");
            }
        });

        // Function to validate and display the status for an input field
        function validateAndDisplayStatus(field, errorId) {
            var value = document.getElementById(field).value.trim();
            var errorElement = document.getElementById(errorId);

            if (value === "") {
                displayStatus(errorElement, 'Please enter your ' + field + '.', 'red');
            } else {
                displayStatus(errorElement, 'Done', 'green');
            }
        }

        // Added event listeners to update error messages when the input fields lose focus
        ['name', 'email', 'message'].forEach(function (field) {
            document.getElementById(field).addEventListener('blur', function () {
                validateAndDisplayStatus(field, field + 'Error');
            });
        });

        // Function to display the status and style for an error message
        function displayStatus(errorElement, message, color) {
            errorElement.innerText = message;
            errorElement.style.color = color;
        }
    </script>
</body>

</html>